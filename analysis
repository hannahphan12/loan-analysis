import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('approved_data_2016_2018.csv', low_memory=False)

# revert to datetime
df['issue_d'] = pd.to_datetime(df['issue_d'])

# Create loan volume over time
# Group data by monthly period
loan_volume = df.groupby(df['issue_d'].dt.to_period('M')).size()

# Plot loan volume
plt.figure(figsize=(12, 6))
loan_volume.plot(kind='line', marker='o')
plt.title('Loan Volume Over Time', fontsize=14)
plt.xlabel('Issue Date', fontsize=12)
plt.ylabel('Number of Loans Issued', fontsize=12)
plt.grid(True)
plt.xticks(rotation=45)
plt.tight_layout()
plt.show()

# Create a performance indicator
# The 'loan_status' column has values 'Fully Paid', 'Charged Off', 'Current', and 'Late(31-120 days)'
df['is_defaulted'] = df['loan_status'].isin(['Charged Off']).astype(int)

# Group by grade and calculate default rate
grade_performance = df.groupby('grade')['is_defaulted'].mean()

# Plot default rate by grade
plt.figure(figsize=(8, 5))
grade_performance.plot(kind='bar')
plt.title('Default Rate by Loan Grade')
plt.xlabel('Loan Grade')
plt.ylabel('Default Rate')
plt.grid(True)
plt.show()
